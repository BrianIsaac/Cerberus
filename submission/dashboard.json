{
  "title": "AI Agent Fleet Health",
  "description": "Unified health dashboard for all AI agents. Use service filter to drill down to specific agents. All agents are tagged with team:ai-agents for fleet-wide visibility.",
  "widgets": [
    {
      "id": 100,
      "definition": {
        "type": "group",
        "title": "Fleet Overview",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 101,
            "definition": {
              "type": "query_value",
              "title": "Total Agents Active",
              "requests": [
                {
                  "q": "count_nonzero(sum:trace.http.request.hits{service IN (ops-assistant,sas-generator)} by {service}.as_count())",
                  "aggregator": "last"
                }
              ]
            }
          },
          {
            "id": 102,
            "definition": {
              "type": "toplist",
              "title": "Request Volume by Agent",
              "requests": [
                {
                  "q": "sum:trace.http.request.hits{service IN (ops-assistant,sas-generator)} by {service}.as_count()",
                  "style": {
                    "palette": "dog_classic"
                  }
                }
              ]
            }
          },
          {
            "id": 103,
            "definition": {
              "type": "toplist",
              "title": "Error Rate by Agent (%)",
              "requests": [
                {
                  "q": "(sum:trace.http.request.errors{service IN (ops-assistant,sas-generator)} by {service}.as_count() / sum:trace.http.request.hits{service IN (ops-assistant,sas-generator)} by {service}.as_count()) * 100",
                  "style": {
                    "palette": "warm"
                  }
                }
              ]
            }
          },
          {
            "id": 104,
            "definition": {
              "type": "toplist",
              "title": "P95 Latency by Agent (s)",
              "requests": [
                {
                  "q": "p95:trace.http.request.duration{service IN (ops-assistant,sas-generator)} by {service}",
                  "style": {
                    "palette": "cool"
                  }
                }
              ]
            }
          }
        ]
      }
    },
    {
      "id": 0,
      "definition": {
        "type": "group",
        "title": "Application Health",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 1,
            "definition": {
              "type": "timeseries",
              "title": "Request Volume",
              "requests": [
                {
                  "q": "sum:trace.http.request.hits{$service,$env}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "dog_classic"
                  }
                }
              ]
            }
          },
          {
            "id": 2,
            "definition": {
              "type": "timeseries",
              "title": "P95 Request Latency",
              "requests": [
                {
                  "q": "p95:trace.http.request.duration{$service,$env}",
                  "display_type": "line"
                }
              ],
              "markers": [
                {
                  "value": "y = 10",
                  "display_type": "error dashed",
                  "label": "SLO Threshold (10s)"
                }
              ]
            }
          },
          {
            "id": 3,
            "definition": {
              "type": "query_value",
              "title": "Error Rate (%)",
              "requests": [
                {
                  "q": "sum:trace.http.request.errors{$service,$env}.as_count() / sum:trace.http.request.hits{$service,$env}.as_count() * 100",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 1,
                      "palette": "white_on_red"
                    },
                    {
                      "comparator": "<=",
                      "value": 1,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ]
            }
          },
          {
            "id": 4,
            "definition": {
              "type": "timeseries",
              "title": "Gemini LLM Latency (P95)",
              "requests": [
                {
                  "q": "p95:trace.google_genai.request{$service,$env}",
                  "display_type": "line"
                }
              ]
            }
          }
        ]
      }
    },
    {
      "id": 10,
      "definition": {
        "type": "group",
        "title": "Governance & Bounded Autonomy",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 11,
            "definition": {
              "type": "query_value",
              "title": "Escalation Rate (%)",
              "requests": [
                {
                  "q": "sum:ai_agent.governance.escalation{$service,$env}.as_count() / sum:ai_agent.request.count{$service,$env}.as_count() * 100",
                  "aggregator": "avg",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 10,
                      "palette": "white_on_red"
                    },
                    {
                      "comparator": "<=",
                      "value": 10,
                      "palette": "white_on_yellow"
                    },
                    {
                      "comparator": "<=",
                      "value": 5,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ]
            }
          },
          {
            "id": 12,
            "definition": {
              "type": "timeseries",
              "title": "Escalations by Reason",
              "requests": [
                {
                  "q": "sum:ai_agent.governance.escalation{$service,$env} by {reason}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "warm"
                  }
                }
              ]
            }
          },
          {
            "id": 13,
            "definition": {
              "type": "timeseries",
              "title": "Budget Utilisation by Type",
              "requests": [
                {
                  "q": "avg:ai_agent.governance.budget_utilisation{$service,$env,budget_type:step}",
                  "display_type": "line"
                },
                {
                  "q": "avg:ai_agent.governance.budget_utilisation{$service,$env,budget_type:model}",
                  "display_type": "line"
                },
                {
                  "q": "avg:ai_agent.governance.budget_utilisation{$service,$env,budget_type:tool}",
                  "display_type": "line"
                }
              ],
              "markers": [
                {
                  "value": "y = 0.8",
                  "display_type": "error dashed",
                  "label": "Warning Threshold (80%)"
                }
              ]
            }
          },
          {
            "id": 14,
            "definition": {
              "type": "timeseries",
              "title": "Security Validation Failures",
              "requests": [
                {
                  "q": "sum:ai_agent.governance.escalation{$service,$env,reason:security_violation}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "red"
                  }
                },
                {
                  "q": "sum:ai_agent.governance.escalation{$service,$env,reason:pii_detected}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "orange"
                  }
                }
              ]
            }
          },
          {
            "id": 15,
            "definition": {
              "type": "query_value",
              "title": "Pending Approvals",
              "requests": [
                {
                  "q": "sum:ai_agent.governance.approval_requested{$service,$env}.as_count()",
                  "aggregator": "last",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 10,
                      "palette": "white_on_red"
                    },
                    {
                      "comparator": "<=",
                      "value": 10,
                      "palette": "white_on_yellow"
                    },
                    {
                      "comparator": "<=",
                      "value": 5,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ]
            }
          },
          {
            "id": 16,
            "definition": {
              "type": "timeseries",
              "title": "Approval Decisions",
              "requests": [
                {
                  "q": "sum:ai_agent.governance.approval_decision{$service,$env,decision:approved}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "green"
                  }
                },
                {
                  "q": "sum:ai_agent.governance.approval_decision{$service,$env,decision:rejected}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "red"
                  }
                },
                {
                  "q": "sum:ai_agent.governance.approval_decision{$service,$env,decision:skipped}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "blue"
                  }
                }
              ]
            }
          },
          {
            "id": 17,
            "definition": {
              "type": "toplist",
              "title": "Top Escalation Reasons",
              "requests": [
                {
                  "q": "top(sum:ai_agent.governance.escalation{$service,$env} by {reason}.as_count(), 5, 'sum', 'desc')",
                  "style": {
                    "palette": "warm"
                  }
                }
              ]
            }
          },
          {
            "id": 18,
            "definition": {
              "type": "timeseries",
              "title": "Quality Scores (LLM-as-Judge)",
              "requests": [
                {
                  "q": "avg:ai_agent.quality.score{$service,$env,metric_name:code_quality}",
                  "display_type": "line"
                },
                {
                  "q": "avg:ai_agent.quality.score{$service,$env,metric_name:correctness_score}",
                  "display_type": "line"
                },
                {
                  "q": "avg:ai_agent.quality.score{$service,$env,metric_name:safety_score}",
                  "display_type": "line"
                }
              ],
              "markers": [
                {
                  "value": "y = 0.7",
                  "display_type": "error dashed",
                  "label": "Approval Threshold"
                }
              ]
            }
          }
        ]
      }
    },
    {
      "id": 60,
      "definition": {
        "type": "group",
        "title": "LLM & Workflow Calls",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 61,
            "definition": {
              "type": "timeseries",
              "title": "Gemini LLM Calls Over Time",
              "requests": [
                {
                  "q": "sum:trace.google_genai.request.hits{$service,$env}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "dog_classic"
                  }
                }
              ]
            }
          },
          {
            "id": 62,
            "definition": {
              "type": "timeseries",
              "title": "LangGraph Workflow Calls",
              "requests": [
                {
                  "q": "sum:trace.langgraph.request.hits{$service,$env}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "cool"
                  }
                }
              ]
            }
          },
          {
            "id": 63,
            "definition": {
              "type": "timeseries",
              "title": "Gemini LLM Latency (avg vs P95)",
              "requests": [
                {
                  "q": "avg:trace.google_genai.request{$service,$env}",
                  "display_type": "line"
                },
                {
                  "q": "p95:trace.google_genai.request{$service,$env}",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "id": 64,
            "definition": {
              "type": "timeseries",
              "title": "LangGraph Errors",
              "requests": [
                {
                  "q": "sum:trace.langgraph.request.errors{$service,$env}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "warm"
                  }
                }
              ]
            }
          }
        ]
      }
    },
    {
      "id": 20,
      "definition": {
        "type": "group",
        "title": "MCP Tools Performance",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 21,
            "definition": {
              "type": "timeseries",
              "title": "MCP Tool Invocations",
              "requests": [
                {
                  "q": "sum:trace.mcp.request.hits{$service,$env}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "dog_classic"
                  }
                }
              ]
            }
          },
          {
            "id": 22,
            "definition": {
              "type": "timeseries",
              "title": "MCP Tool Latency (avg vs P95)",
              "requests": [
                {
                  "q": "avg:trace.mcp.request{$service,$env}",
                  "display_type": "line"
                },
                {
                  "q": "p95:trace.mcp.request{$service,$env}",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "id": 23,
            "definition": {
              "type": "query_value",
              "title": "MCP Error Rate (%)",
              "requests": [
                {
                  "q": "sum:trace.mcp.request.errors{$service,$env}.as_count() / sum:trace.mcp.request.hits{$service,$env}.as_count() * 100",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 10,
                      "palette": "white_on_red"
                    },
                    {
                      "comparator": "<=",
                      "value": 10,
                      "palette": "white_on_yellow"
                    },
                    {
                      "comparator": "<=",
                      "value": 1,
                      "palette": "white_on_green"
                    }
                  ]
                }
              ]
            }
          },
          {
            "id": 24,
            "definition": {
              "type": "query_value",
              "title": "MCP Apdex Score",
              "requests": [
                {
                  "q": "avg:trace.mcp.request.apdex{$service,$env}",
                  "conditional_formats": [
                    {
                      "comparator": ">",
                      "value": 0.9,
                      "palette": "white_on_green"
                    },
                    {
                      "comparator": "<=",
                      "value": 0.9,
                      "palette": "white_on_yellow"
                    },
                    {
                      "comparator": "<=",
                      "value": 0.7,
                      "palette": "white_on_red"
                    }
                  ]
                }
              ]
            }
          }
        ]
      }
    },
    {
      "id": 30,
      "definition": {
        "type": "group",
        "title": "Quality Evaluations",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 31,
            "definition": {
              "type": "timeseries",
              "title": "RAGAS Faithfulness Score",
              "requests": [
                {
                  "q": "avg:llmobs.evaluation.ragas_faithfulness{*}",
                  "display_type": "line"
                }
              ],
              "markers": [
                {
                  "value": "y = 0.7",
                  "display_type": "error dashed",
                  "label": "Minimum Acceptable"
                }
              ]
            }
          },
          {
            "id": 32,
            "definition": {
              "type": "timeseries",
              "title": "RAGAS Answer Relevancy Score",
              "requests": [
                {
                  "q": "avg:llmobs.evaluation.ragas_answer_relevancy{*}",
                  "display_type": "line"
                }
              ],
              "markers": [
                {
                  "value": "y = 0.7",
                  "display_type": "error dashed",
                  "label": "Minimum Acceptable"
                }
              ]
            }
          },
          {
            "id": 33,
            "definition": {
              "type": "timeseries",
              "title": "LLM Obs Evaluation Spans",
              "requests": [
                {
                  "q": "sum:llmobs.span.count{span_kind:evaluation}.as_count()",
                  "display_type": "bars",
                  "style": {
                    "palette": "dog_classic"
                  }
                }
              ]
            }
          },
          {
            "id": 34,
            "definition": {
              "type": "timeseries",
              "title": "LLM Input Tokens",
              "requests": [
                {
                  "q": "sum:llmobs.tokens.input{*}",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "id": 35,
            "definition": {
              "type": "timeseries",
              "title": "LLM Output Tokens",
              "requests": [
                {
                  "q": "sum:llmobs.tokens.output{*}",
                  "display_type": "line"
                }
              ]
            }
          },
          {
            "id": 36,
            "definition": {
              "type": "timeseries",
              "title": "LLM Span Duration (P95)",
              "requests": [
                {
                  "q": "p95:llmobs.span.duration{span_kind:llm}",
                  "display_type": "line",
                  "style": {
                    "palette": "cool"
                  }
                }
              ]
            }
          }
        ]
      }
    },
    {
      "id": 50,
      "definition": {
        "type": "group",
        "title": "Operations & Actionable Items",
        "layout_type": "ordered",
        "widgets": [
          {
            "id": 51,
            "definition": {
              "type": "manage_status",
              "title": "Monitor Status Panel",
              "summary_type": "monitors",
              "display_format": "countsAndList",
              "query": "$service"
            }
          },
          {
            "id": 52,
            "definition": {
              "type": "event_stream",
              "title": "Active Incidents & Cases",
              "query": "sources:incident,case $service",
              "event_size": "s"
            }
          },
          {
            "id": 53,
            "definition": {
              "type": "trace_service",
              "title": "Worst Traces (Highest Latency)",
              "service": "",
              "span_name": "http.request",
              "env": "$env",
              "display_format": "three_column",
              "show_breakdown": true,
              "show_distribution": true,
              "show_errors": true,
              "show_hits": true,
              "show_latency": true,
              "show_resource_list": true,
              "size_format": "large"
            }
          }
        ]
      }
    }
  ],
  "layout_type": "ordered",
  "template_variables": [
    {
      "name": "env",
      "default": "*",
      "prefix": "env",
      "available_values": [
        "production",
        "staging",
        "development"
      ]
    },
    {
      "name": "service",
      "default": "*",
      "prefix": "service",
      "available_values": [
        "dashboard-enhancer",
        "ops-assistant",
        "sas-generator"
      ]
    }
  ]
}
